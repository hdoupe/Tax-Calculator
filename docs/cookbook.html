<!DOCTYPE html>
<html>
<head>
<title>Tax-Calculator Cookbook</title>
<style>
div { max-width: 19cm }
</style>
</head>
<body>
<div>

<h1 id="toc">Cookbook of Tested Recipes for Python Programming with
Tax-Calculator</h1>

<p>This document tells you how to use Tax-Calculator, an open-source
federal income and payroll tax simulation model, in Python scripts
that you can run on your own computer.  Note that these recipes
require Tax-Calculator release 0.23.0 or higher running on Python 3.6.
For other ways of using Tax-Calculator, see the
<a href="https://open-source-economics.github.io/Tax-Calculator/">
user documentation</a>, which this Cookbook assumes you have read.</p>

<p>In order to write correct and effective Python scripts you need to be
familiar with the public API of the Tax-Calculator library, which is available
<a href="https://taxcalc.readthedocs.io/en/latest/public_api.html">here</a>.
</p>

<h2>Cookbook Contents</h2>

<p><b>Preliminaries</b></p>

<p><a href="#setup">Kitchen Setup</a> on how to setup your computer to
follow these recipes</p>

<p><a href="#techniques">Recipe Techniques</a> on rules to follow when
modifying the recipes in this cookbook</p>

<p><a href="#ingredients">Recipe Ingredients</a> on how get the
ingredients required for these recipes in your kitchen</p>

<p><a href="#feedback">Recipe Feedback</a> on how request a new recipe
be added to this cookbook or <br> report problems encountered when
following an existing recipe</p>

<p><b>Basic Recipe</b></p>

<p><a href="#recipe00">Static Analysis of a Simple Reform</a></p>

<p><b>Advanced Recipes</b></p>

<p><a href="#recipe01">(1) Directly Comparing Two Reforms</a></p>

<p><a href="#recipe02">(2) Estimating Behavioral Response to Tax Reform</a></p>

<p><a href="#recipe03">(3) Creating a Custom Table</a></p>

<p><a href="#recipe04">(4) Estimating Reform Response by Earnings Group</a></p>


<h2 id="setup">Preliminaries: Kitchen Setup</h2>

<p>You need to setup your computer in certain ways in order to follow
these recipes.  First, follow
<a href="https://open-source-economics.github.io/Tax-Calculator/#cli-install-test">these instructions</a> on installing Anaconda and a taxcalc package on
your computer. And second, install the recipes and ingredients in this
cookbook on your computer.  There are several ways to do this.  If you
have cloned the Tax-Calculator repository (see the
<a href="https://taxcalc.readthedocs.io/en/latest/contributor_guide.html">
Contributor Guide</a>), then the recipes are located in the
<kbd>Tax-Calculator/docs/cookbook</kbd> directory.  If you haven't
cloned the repository, you have a couple of choices. You can download
the source code as a zip file by clicking on the green <q>Clone or
download</q> button on
<a href="https://github.com/open-source-economics/Tax-Calculator">
this page</a>. This choice has the advantage of replicating the
directory structure and file names that we use in our test kitchen.
To comfirm your unzipped installation is valid, execute
<kbd>python test_recipes.py</kbd> in the
<kbd>Tax-Calculator/docs/cookbook</kbd> directory to make sure all the
recipes <kbd>PASS</kbd>.  Or you can copy and paste the recipes and
ingredients, as needed, to your local computer.  If you make this
second choice, you may need to edit file paths in the recipes
depending on how you've organized and named the copied-and-pasted
files.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="techniques">Preliminaries: Recipe Techniques</h2>

<p>As with any cookbook, the best approach is to follow a recipe
exactly the first time and then, if needed, modify the recipe to get
the exactly the <q>dish</q> you want. Remember to copy a recipe file
and give it a new file name before you start to modify the recipe.</p>

<p>The Calculator object is the central object in Tax-Calculator and
it is created by passing three secondary objects (a Policy object, a
Records object, and a Consumption object) to the
Calculator class constructor. When modifying a recipe, following a
few rules will minimize the chance of running into problems.</p>

<p>Fully specify Policy, Records, and Consumption objects
before passing them to the Calculator class constructor.</p>

<p>After initializing a Calculator object, manipulate it using only
Calculator class methods.</p>

<p>Following these two rules means avoiding the manipulation of a
Calculator object's private internal objects.  You should definitely
avoid trying to change those internal Calculator objects.  And if you
find yourself wanting to read those internal objects, look for a way
to do that using public Calculator methods.  If no Calculator methods
allow you to get out of the Calculator object the information you
need,
<a href="https://github.com/open-source-economics/Tax-Calculator/issues">
create a new issue</a> asking for a Tax-Calculator enhancement.</p>

<p id="execution">The recipes in this cookbook are Python scripts that
can be executed from the command line like this:
<pre>
python recipe00.py > recipe00.out
diff recipe00.out recipe00.res
</pre>
Your kitchen setup and ability to follow a recipe and produce the same
<q>dish</q> as we produce in our test kitchen would be validated if
the above <kbd>diff</kbd> command yields no differences. Of course,
you can substitute your favorite graphical diff program
for <kbd>diff</kbd> to get an easier to read set of differences.</p>

<p>Some people like to use Tax-Calculator inside an interactive
notebook.  You should be able to load a recipe into an empty notebook
and execute it there.  If you want to work that way, the recipes may
require some modification to show results interactively.  But if you
are a notebook user, you will know how to make a recipe work in a
notebook.</p>

<p>After writing an HTML graph file to disk, you can view it in your
favorite browser.  The easiest way to do that varies by operating
system.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="ingredients">Preliminaries: Recipe Ingredients</h2>

<p>All the ingredients needed for the recipes are included in
the <kbd>Tax-Calculator/docs/cookbook/ingredients</kbd> directory.  If
you organize the recipes and ingredients in a different way than they
are organized in our test kitchen, you will need to change the file
path for each ingredient in each recipe.</p>

<p>Just like with recipe modification, copy and rename an ingredient
file before you make modifications to it.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="feedback">Preliminaries: Recipe Feedback</h2>

<p>If you want to request a recipe that makes a new <q>dish</q>,
create a new issue
<a href="https://github.com/open-source-economics/Tax-Calculator/issues">here</a>
providing details on what you want to make and why the existing recipes
cannot be easily modified to make what you want.</p>

<p>Also, please report, in the same way, any problems you experience
following an existing recipe.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="recipe00">Basic Recipe: Static Analysis of a Simple Reform</h2>

<p>This is the recipe you should follow first.  Mastering this recipe
is a prerequisite for all the other recipes in this cookbook.</p>

<p><b>Ingredients</b></p>

<p><a href="reformA.json.html" target="_blank">Policy reform</a> in
the <kbd>ingredients/reformA.json</kbd> file.</p>
 
<p><b>Instructions</b></p>

<p><a href="recipe00.py.html" target="_blank">Step-by-step
instructions</a> in the <kbd>recipe00.py</kbd> file.</p>

<p><b>Results</b></p>

<p><a href="recipe00.res.html" target="_blank">Expected text
results</a> from executing <kbd>python recipe00.py > recipe00.out</kbd> at
the command prompt as shown <a href="#execution">above</a>.</p>

<p><a href="recipe00.graph.html" target="_blank">Expected graph</a> (located
in the same directory as <kbd>recipe00.py</kbd> and named
<kbd>recipe00.graph.html</kbd>) from executing
<kbd>python recipe00.py > recipe00.out</kbd> at the command prompt as
shown <a href="#execution">above</a>. To view the HTML graph file
generated when you follow the recipe, open it in your favorite
browser.  For example, on a Mac, you would enter at the command
prompt<br><kbd>open recipe00.graph.html</kbd><br>to start your
default browser showing the graph.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="recipe01">Advanced Recipe: (1) Directly Comparing Two Reforms</h2>

<p>This is an advanced recipe that should be followed only after
mastering the <a href="#recipe00">basic recipe</a>.  This recipe
shows how to compare two reforms (instead of comparing a reform
to current-law policy) and also shows how to use the reform files
available on the Tax-Calculator website (instead of reform files
on your computer's disk).</p>

<p><b>Ingredients</b></p>

<p>No ingredients required because we read reform files from the
Tax-Calculator website.</p>

<p><b>Instructions</b></p>

<p><a href="recipe01.py.html" target="_blank">Step-by-step
instructions</a> in the <kbd>recipe01.py</kbd> file.</p>

<p><b>Results</b></p>

<p><a href="recipe01.res.html" target="_blank">Expected text
results</a> from executing <kbd>python recipe01.py > recipe01.out</kbd> at
the command prompt as illustrated <a href="#execution">above</a>.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="recipe02">Advanced Recipe: (2) Estimating Behavioral Response
to Tax Reform</h2>

<p>This is an advanced recipe that should be followed only after
mastering the <a href="#recipe00">basic recipe</a>.  This recipe
shows how to analyze the behavioral responses to a tax reform using
the Behavioral-Responses <kbd>behresp</kbd> package.  Before following
this recipe, be sure to install the <kbd>behresp</kbd> package on your
compter by executing this at the command prompt:
<kbd>conda install -c PSLmodels behresp</kbd></p>

<p><b>Ingredients</b></p>

<p><a href="reformA.json.html" target="_blank">Policy reform</a> in
the <kbd>ingredients/reformA.json</kbd> file.</p>

<p><b>Instructions</b></p>

<p><a href="recipe02.py.html" target="_blank">Step-by-step
instructions</a> in the <kbd>recipe02.py</kbd> file.</p>

<p><b>Results</b></p>

<p><a href="recipe02.res.html" target="_blank">Expected text
results</a> from executing <kbd>python recipe02.py > recipe02.out</kbd> at
the command prompt as illustrated <a href="#execution">above</a>.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="recipe03">Advanced Recipe: (3) Creating a Custom Table</h2>

<p>This is an advanced recipe that should be followed only after
mastering the <a href="#recipe00">basic recipe</a>.  This recipe
shows how to prepare a custom table.</p>

<p><b>Ingredients</b></p>

<p>No ingredients required because we conduct analysis under
current-law policy.</p>

<p><b>Instructions</b></p>

<p><a href="recipe03.py.html" target="_blank">Step-by-step
instructions</a> in the <kbd>recipe03.py</kbd> file.</p>

<p><b>Results</b></p>

<p><a href="recipe03.res.html" target="_blank">Expected text
results</a> from executing <kbd>python recipe03.py > recipe03.out</kbd> at
the command prompt as illustrated <a href="#execution">above</a>.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


<h2 id="recipe04">Advanced Recipe: (4) Estimating Reform Response by Earnings Group</h2>

<p>This is an advanced recipe that should be followed only after
mastering the <a href="#recipe00">basic recipe</a>.  This recipe shows
how to estimate the reform response in charitable giving when the
response elasticities vary by earnings group.  It employs the groupby
technique used in the <a href="#recipe03">Creating a Custom Table</a>
recipe, so you might want to read that recipe first.</p>

<p><b>Ingredients</b></p>

<p><a href="reformB.json.html" target="_blank">Policy reform</a> in
the <kbd>ingredients/reformA.json</kbd> file.  Note that this reform
increases the personal exemption amount (from zero where it is under
current-law policy) and decreases the standard deduction amounts (so
they are approximately where they were before the TCJA reform that is
now current-law policy).</p>

<p><b>Instructions</b></p>

<p><a href="recipe04.py.html" target="_blank">Step-by-step
instructions</a> in the <kbd>recipe04.py</kbd> file.</p>

<p><b>Results</b></p>

<p><a href="recipe04.res.html" target="_blank">Expected text
results</a> from executing <kbd>python recipe04.py > recipe04.out</kbd> at
the command prompt as illustrated <a href="#execution">above</a>.</p>

<p><a href="#toc">Back to Cookbook Contents</a></p>


</div>
</body>
</html>
